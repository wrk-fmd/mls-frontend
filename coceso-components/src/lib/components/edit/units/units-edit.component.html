<main>
  <mat-card class="mat-elevation-z4">
    <mat-card-title translate>concern.edit.units</mat-card-title>
    <mat-card-content>
      <table mat-table [dataSource]="units">
        <ng-container matColumnDef="call">
          <th mat-header-cell *matHeaderCellDef translate>unit.call</th>

          <td mat-cell *matCellDef="let form, let i = index">
            <ng-container *ngTemplateOutlet="callColumn; context: {form: form, index: i}"></ng-container>
          </td>

          <td mat-footer-cell *matFooterCellDef>
            <ng-container *ngTemplateOutlet="callColumn; context: {form: createForm, index: 'create'}"></ng-container>
          </td>
        </ng-container>

        <ng-container matColumnDef="type">
          <th mat-header-cell *matHeaderCellDef translate>unit.type.label</th>

          <td mat-cell *matCellDef="let form, let i = index">
            <ng-container *ngTemplateOutlet="typeColumn; context: {form: form, index: i}"></ng-container>
          </td>

          <td mat-footer-cell *matFooterCellDef>
            <ng-container *ngTemplateOutlet="typeColumn; context: {form: createForm, index: 'create'}"></ng-container>
          </td>
        </ng-container>

        <ng-container matColumnDef="info">
          <th mat-header-cell *matHeaderCellDef translate>unit.info</th>

          <td mat-cell *matCellDef="let form, let i = index">
            <ng-container *ngTemplateOutlet="infoColumn; context: {form: form, index: i}"></ng-container>
          </td>

          <td mat-footer-cell *matFooterCellDef>
            <ng-container *ngTemplateOutlet="infoColumn; context: {form: createForm, index: 'create'}"></ng-container>
          </td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef translate></th>

          <td mat-cell *matCellDef="let form, let i = index">
            <form [formGroup]="form" [id]="'unit-form-' + i" (ngSubmit)="submit(form)">
              <button mat-flat-button color="primary" [disabled]="submitDisabled(form)">{{'unit.edit.submit' | translate}}</button>
            </form>
          </td>

          <td mat-footer-cell *matFooterCellDef>
            <form [formGroup]="createForm" id="unit-form-create" (ngSubmit)="submit(createForm)">
              <button mat-flat-button color="primary" [disabled]="submitDisabled(createForm)">{{'unit.edit.submit' | translate}}</button>
            </form>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        <tr mat-footer-row *matFooterRowDef="displayedColumns"></tr>
      </table>
    </mat-card-content>
  </mat-card>
</main>

<ng-template #callColumn let-form="form" let-index="index">
  <mat-form-field [formGroup]="form">
    <input matInput formControlName="call" [attr.form]="'unit-form-' + index" [placeholder]="'unit.call' | translate" required>
  </mat-form-field>

  <mat-form-field *ngIf="sections | async as sections" [formGroup]="form">
    <mat-select formControlName="section" [attr.form]="'unit-form-' + index" [placeholder]="'concern.section' | translate">
      <mat-option [value]="null">{{'concern.section' | translate}}</mat-option>
      <mat-option *ngFor="let section of sections" [value]="section">{{section}}</mat-option>
    </mat-select>
  </mat-form-field>
</ng-template>

<ng-template #typeColumn let-form="form" let-index="index">
  <mat-form-field [formGroup]="form">
    <mat-select formControlName="type" [attr.form]="'unit-form-' + index" [placeholder]="'unit.type.label' | translate" required>
      <mat-option [value]="null" disabled>{{'unit.type.label' | translate}}</mat-option>
      <mat-option *ngFor="let type of types" [value]="type">{{'unit.type.' + type | translate}}</mat-option>
    </mat-select>
  </mat-form-field>
</ng-template>

<ng-template #infoColumn let-form="form" let-index="index">
  <mat-form-field [formGroup]="form">
    <textarea matInput formControlName="info" [attr.form]="'unit-form-' + index" [placeholder]="'unit.info' | translate"></textarea>
  </mat-form-field>
</ng-template>
